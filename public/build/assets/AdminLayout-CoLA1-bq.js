import{h as E}from"./moment-C5S46NFB.js";import{_ as z,d as k,b as t,w as r,a as c,c as l,g as d,r as u,m as g,t as h,f as p,h as M,C as T,o as a}from"./app-DXzZSook.js";import{r as j}from"./uploads-CnEkgyD_.js";const J={data(){return{drawer:!0,currentUser:null,userRoles:[],userPermissions:[],currentDate:E().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),unreadCount:0,unreadCountInterval:null,brandingLogo:null,siteName:null}},computed:{resolvedBrandingLogo(){return this.brandingLogo?this.resolveImageUrl(this.brandingLogo):null},resolvedUserAvatar(){return!this.currentUser||!this.currentUser.avatar?null:this.resolveImageUrl(this.currentUser.avatar)}},methods:{async loadUser(){var m;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const f=await this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=f.data,this.userRoles=f.data.roles||[],this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(_=>{_.permissions&&_.permissions.length>0&&_.permissions.forEach(s=>{this.userPermissions.includes(s.slug)||this.userPermissions.push(s.slug)})})}catch(e){console.error("Error loading user:",e),((m=e.response)==null?void 0:m.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadBrandingSettings(){try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/settings",{headers:{Authorization:`Bearer ${m}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value&&(this.siteName=e.data.general.site_name.value),e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value&&(this.brandingLogo=e.data.branding.logo.value)}catch(m){console.error("Error loading branding settings:",m)}},async logout(){await T().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(m){return this.currentUser&&(this.currentUser.role==="admin"||this.userRoles&&this.userRoles.some(e=>e.slug==="administrator"))?!0:this.userPermissions.includes(m)},async loadUnreadCount(){if(this.hasPermission("view-leads"))try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/leads/unread-count",{headers:{Authorization:`Bearer ${m}`}});this.unreadCount=e.data.count||0}catch(m){console.error("Error loading unread count:",m)}},startUnreadCountPolling(){this.loadUnreadCount(),this.unreadCountInterval=setInterval(()=>{this.loadUnreadCount()},3e4)},stopUnreadCountPolling(){this.unreadCountInterval&&(clearInterval(this.unreadCountInterval),this.unreadCountInterval=null)},resolveImageUrl(m){return j(m)}},mounted(){localStorage.getItem("admin_token")?(this.loadUser().then(()=>{this.startUnreadCountPolling()}),this.loadBrandingSettings()):this.$router.push("/admin/login")},provide(){return{refreshUnreadCount:()=>{this.loadUnreadCount()}}},watch:{$route(){this.loadUnreadCount()}},beforeUnmount(){this.stopUnreadCountPolling()}},F={class:"d-flex align-center justify-space-between w-100"},q={key:0,class:"unread-badge"},G={class:"pa-2"},H={key:1,class:"d-flex align-center mr-4"},K={class:"footer-content"},O={class:"footer-info"},Q={class:"copyright-text"};function W(m,e,f,_,s,o){const n=u("v-list-item"),C=u("v-divider"),v=u("v-list-group"),b=u("v-list"),A=u("v-icon"),x=u("v-btn"),L=u("v-navigation-drawer"),R=u("v-app-bar-nav-icon"),P=u("v-chip"),U=u("v-spacer"),y=u("v-img"),B=u("v-avatar"),w=u("v-list-item-title"),I=u("v-menu"),S=u("v-app-bar"),N=u("router-view"),V=u("v-container"),D=u("v-main"),Y=u("v-footer");return a(),k("div",null,[t(L,{modelValue:s.drawer,"onUpdate:modelValue":e[1]||(e[1]=i=>s.drawer=i),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:r(()=>[c("div",G,[t(x,{link:"",router:"",onClick:e[0]||(e[0]=i=>o.logout()),class:"logout-btn text-black",size:"small",block:""},{default:r(()=>[t(A,{left:""},{default:r(()=>e[5]||(e[5]=[p("mdi-logout")])),_:1,__:[5]}),e[6]||(e[6]=p("Logout "))]),_:1,__:[6]})])]),default:r(()=>[e[7]||(e[7]=c("div",{class:"sidebar-shapes"},[c("div",{class:"shape shape-1"}),c("div",{class:"shape shape-2"}),c("div",{class:"shape shape-3"})],-1)),s.currentUser?(a(),l(n,{key:0,class:"user-profile-header","prepend-avatar":o.resolvedBrandingLogo||o.resolvedUserAvatar||"/assets/logo/logo.png",title:s.siteName||"Admin Panel",subtitle:s.userRoles&&s.userRoles.length>0?s.userRoles.map(i=>i.name).join(", "):"No roles assigned"},null,8,["prepend-avatar","title","subtitle"])):d("",!0),t(C,{class:"my-0 divider-glow"}),t(b,{density:"compact",nav:""},{default:r(()=>[o.hasPermission("access-dashboard")?(a(),l(n,{key:0,link:"",router:"","prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})):d("",!0),o.hasPermission("manage-products")?(a(),l(v,{key:1,value:"products","prepend-icon":"mdi-package-variant","no-action":""},{activator:r(({props:i})=>[t(n,g(i,{title:"Products"}),null,16)]),default:r(()=>[t(n,{"prepend-icon":"mdi-package-variant",title:"Products",to:{name:"AdminProducts"}}),t(n,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminCategories"}}),t(n,{"prepend-icon":"mdi-tag",title:"Tags",to:{name:"AdminTags"}})]),_:1})):d("",!0),o.hasPermission("manage-services")?(a(),l(n,{key:2,link:"",router:"","prepend-icon":"mdi-wrench",title:"Services",to:{name:"AdminServices"},value:"Services",exact:""})):d("",!0),o.hasPermission("manage-pages")?(a(),l(n,{key:3,link:"",router:"","prepend-icon":"mdi-information",title:"About Page",to:{name:"AdminAbout"},value:"About",exact:""})):d("",!0),o.hasPermission("manage-pages")?(a(),l(v,{key:4,value:"blog","prepend-icon":"mdi-post","no-action":""},{activator:r(({props:i})=>[t(n,g(i,{title:"Blog"}),null,16)]),default:r(()=>[t(n,{"prepend-icon":"mdi-post",title:"Blog Posts",to:{name:"AdminBlog"}}),t(n,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminBlogCategories"}})]),_:1})):d("",!0),o.hasPermission("manage-pages")||o.hasPermission("view-leads")?(a(),l(v,{key:5,value:"careers","prepend-icon":"mdi-briefcase","no-action":""},{activator:r(({props:i})=>[t(n,g(i,{title:"Careers"}),null,16)]),default:r(()=>[o.hasPermission("manage-pages")?(a(),l(n,{key:0,"prepend-icon":"mdi-briefcase",title:"Careers",to:{name:"AdminCareers"}})):d("",!0),o.hasPermission("view-leads")?(a(),l(n,{key:1,"prepend-icon":"mdi-file-document-edit",title:"Job Applications",to:{name:"AdminJobApplications"}})):d("",!0)]),_:1})):d("",!0),o.hasPermission("manage-users")?(a(),l(n,{key:6,link:"",router:"","prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):d("",!0),o.hasPermission("manage-roles")?(a(),l(v,{key:7,value:"roles","prepend-icon":"mdi-shield-account","no-action":""},{activator:r(({props:i})=>[t(n,g(i,{title:"Roles & Permissions"}),null,16)]),default:r(()=>[t(n,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),t(n,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):d("",!0),o.hasPermission("view-leads")?(a(),l(n,{key:8,link:"",router:"","prepend-icon":"mdi-email",to:{name:"AdminLeads"},value:"Leads",exact:"",class:"leads-menu-item"},{title:r(()=>[c("div",F,[e[4]||(e[4]=c("span",null,"Leads",-1)),s.unreadCount>0?(a(),k("span",q,h(s.unreadCount>99?"99+":s.unreadCount),1)):d("",!0)])]),_:1})):d("",!0),o.hasPermission("view-leads")?(a(),l(n,{key:9,link:"",router:"","prepend-icon":"mdi-email-newsletter",to:{name:"AdminNewsletters"},value:"Newsletters",exact:"",title:"Newsletters"})):d("",!0),o.hasPermission("manage-settings")?(a(),l(n,{key:10,link:"",router:"","prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):d("",!0),o.hasPermission("view-login-logs")||o.hasPermission("view-visitor-logs")?(a(),l(v,{key:11,value:"logs","prepend-icon":"mdi-file-document-multiple","no-action":""},{activator:r(({props:i})=>[t(n,g(i,{title:"Logs"}),null,16)]),default:r(()=>[o.hasPermission("view-login-logs")?(a(),l(n,{key:0,"prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"}})):d("",!0),o.hasPermission("view-visitor-logs")?(a(),l(n,{key:1,"prepend-icon":"mdi-account-group",title:"Visitor Logs",to:{name:"AdminVisitorLogs"}})):d("",!0)]),_:1})):d("",!0)]),_:1})]),_:1,__:[7]},8,["modelValue"]),t(S,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:r(()=>[t(R,{onClick:e[2]||(e[2]=M(i=>s.drawer=!s.drawer,["stop"]))}),t(P,{class:"mx-2 date-chip"},{default:r(()=>[p(h(s.currentDate),1)]),_:1}),t(U),s.currentUser&&(s.currentUser.role==="admin"||s.userRoles&&s.userRoles.some(i=>i.slug==="administrator"))?(a(),l(P,{key:0,"prepend-icon":"mdi-shield-account"},{default:r(()=>e[8]||(e[8]=[p("Administrator")])),_:1,__:[8]})):d("",!0),t(U),s.currentUser?(a(),k("div",H,[t(I,{"open-on-hover":""},{activator:r(({props:i})=>[t(B,g(i,{size:"42",class:"fill-image mr-2",title:s.currentUser.name}),{default:r(()=>[s.currentUser.avatar?(a(),l(y,{key:0,cover:"",src:o.resolvedUserAvatar,alt:s.currentUser.name},null,8,["src","alt"])):(a(),l(y,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:r(()=>[t(b,null,{default:r(()=>[t(n,null,{default:r(()=>[t(w,null,{default:r(()=>[p(h(s.currentUser.name),1)]),_:1})]),_:1}),t(n,{link:"",router:"",onClick:e[3]||(e[3]=i=>o.logout())},{default:r(()=>[t(w,null,{default:r(()=>e[9]||(e[9]=[p("Logout")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1})])):d("",!0)]),_:1}),t(D,null,{default:r(()=>[t(V,{fluid:""},{default:r(()=>[t(N)]),_:1})]),_:1}),t(Y,{class:"footer-modern gradient_color rtl-footer",app:""},{default:r(()=>[c("div",K,[e[11]||(e[11]=c("div",{class:"footer-brand"},[c("div",{class:"logo-wrapper"},[c("img",{src:"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"})]),c("div",{class:"brand-text"},[c("span",{class:"brand-name"},"Powered By CPB-IT")])],-1)),e[12]||(e[12]=c("div",{class:"footer-divider"},null,-1)),c("div",O,[e[10]||(e[10]=c("span",{class:"version-badge"},"v2.0",-1)),c("span",Q,"Â© "+h(s.currentYear)+" All Rights Reserved",1)])])]),_:1})])}const ee=z(J,[["render",W],["__scopeId","data-v-cf3e5a3e"]]);export{ee as default};
