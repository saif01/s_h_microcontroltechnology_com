import{_ as L,d as c,a as n,b as t,w as l,f as u,r as d,g as w,t as i,F as S,e as I,c as U,l as M,z as O,A as j,h as b,o as p}from"./app-DEFCgX4U.js";import{a as T}from"./adminPaginationMixin-DN7Wb3ng.js";const H={mixins:[T],data(){return{users:[],roles:[],roleFilter:null,roleOptions:[],dialog:!1,editingUser:null,saving:!1,form:{name:"",email:"",role_ids:[],password:"",password_confirmation:"",avatar:""},rules:{required:s=>Array.isArray(s)?s.length>0||"At least one role is required":!!s||"This field is required",email:s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||"Invalid email",minLength:s=>s?s.length>=8||"Password must be at least 8 characters":!0},currentUserId:null,showPassword:!1,showPasswordConfirmation:!1}},async mounted(){await this.loadRoles(),await this.loadUsers(),this.loadCurrentUser()},methods:{async loadUsers(){try{this.loading=!0;const s=this.buildPaginationParams();this.search&&(s.search=this.search),this.roleFilter&&(s.role=this.roleFilter);const e=await b.get("/api/v1/users",{params:s,headers:this.getAuthHeaders()});this.users=e.data.data,this.updatePagination(e.data)}catch(s){this.handleApiError(s,"Failed to load users")}finally{this.loading=!1}},async loadRoles(){try{const s=await b.get("/api/v1/users/roles",{headers:this.getAuthHeaders()});this.roles=s.data.roles,this.roleOptions=this.roles.map(e=>({title:e.label,value:e.value}))}catch(s){console.error("Error loading roles:",s)}},loadCurrentUser(){const s=localStorage.getItem("admin_token");b.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${s}`}}).then(e=>{this.currentUserId=e.data.id}).catch(()=>{})},openDialog(s){if(s){this.editingUser=s;const e=s.roles?s.roles.map(h=>h.id):[];this.form={name:s.name,email:s.email,role_ids:e,password:"",password_confirmation:"",avatar:s.avatar||""}}else{this.editingUser=null;const e=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:e?[e]:[],password:"",password_confirmation:"",avatar:""}}this.dialog=!0},closeDialog(){this.dialog=!1,this.editingUser=null;const s=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:s?[s]:[],password:"",password_confirmation:"",avatar:""},this.showPassword=!1,this.showPasswordConfirmation=!1,this.$refs.form&&this.$refs.form.resetValidation()},async saveUser(){var s,e,h,P;if(this.form.password&&this.form.password!==this.form.password_confirmation){this.showError("Passwords do not match");return}if(!this.editingUser&&!this.form.password){this.showError("Password is required for new users");return}if(this.editingUser&&this.form.password&&!this.form.password_confirmation){this.showError("Please confirm the password");return}if(this.$refs.form.validate()){this.saving=!0;try{const o=localStorage.getItem("admin_token"),a=this.editingUser?`/api/v1/users/${this.editingUser.id}`:"/api/v1/users",m={...this.form};this.form.role_ids&&(m.role_ids=Array.isArray(this.form.role_ids)?this.form.role_ids:[this.form.role_ids]),this.form.password?m.password_confirmation=this.form.password_confirmation:(delete m.password,delete m.password_confirmation),delete m.role;const g=this.editingUser?"put":"post";await b[g](a,m,{headers:{Authorization:`Bearer ${o}`}}),this.showSuccess(this.editingUser?"User updated successfully":"User created successfully"),this.closeDialog(),await this.loadUsers()}catch(o){console.error("Error saving user:",o);let a="Error saving user";if((e=(s=o.response)==null?void 0:s.data)!=null&&e.errors){const m=o.response.data.errors,g=[];Object.keys(m).forEach(_=>{g.push(m[_][0])}),a=g.join(", ")}else(P=(h=o.response)==null?void 0:h.data)!=null&&P.message&&(a=o.response.data.message);this.showError(a)}finally{this.saving=!1}}},async deleteUser(s){if(s.id===this.currentUserId){this.showError("You cannot delete your own account");return}if(confirm(`Are you sure you want to delete ${s.name}?`))try{const e=localStorage.getItem("admin_token");await b.delete(`/api/v1/users/${s.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("User deleted successfully"),await this.loadUsers()}catch(e){this.handleApiError(e,"Error deleting user")}},getRoleLabel(s){const e=this.roles.find(h=>h.slug===s);return e?e.label:s},getRoleColor(s){return{administrator:"error",editor:"primary","hr-user":"success",staff:"info"}[s]||"primary"},onPerPageChange(){this.resetPagination(),this.loadUsers()},onSort(s){this.handleSort(s),this.loadUsers()}}},Y={class:"page-header"},G={class:"text-caption text-grey"},J={key:0},K={class:"d-flex align-center"},Q={class:"d-flex align-center"},W={class:"d-flex align-center"},X={class:"d-flex align-center gap-2"},Z={class:"text-white"},$={key:0,class:"d-flex flex-wrap gap-1"},ee={key:1,class:"text-caption text-grey"},se={key:0},oe={class:"d-flex justify-space-between align-center mt-4"},re={class:"text-caption text-grey"},te={key:0},le={key:1},ne={key:1,class:"text-grey text-caption align-self-center"};function ae(s,e,h,P,o,a){const m=d("v-btn"),g=d("v-select"),_=d("v-col"),v=d("v-text-field"),z=d("v-row"),V=d("v-card-text"),k=d("v-card"),A=d("v-card-title"),y=d("v-icon"),E=d("v-avatar"),C=d("v-chip"),q=d("v-table"),R=d("v-pagination"),x=d("v-list-item"),N=d("v-form"),F=d("v-spacer"),D=d("v-card-actions"),B=d("v-dialog");return p(),c("div",null,[n("div",Y,[e[18]||(e[18]=n("h1",{class:"text-h4 page-title"},"User Management",-1)),t(m,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=r=>a.openDialog(null)),class:"add-button"},{default:l(()=>e[17]||(e[17]=[u(" Add New User ")])),_:1,__:[17]})]),t(k,{class:"mb-4"},{default:l(()=>[t(V,null,{default:l(()=>[t(z,null,{default:l(()=>[t(_,{cols:"12",md:"4"},{default:l(()=>[t(g,{modelValue:s.perPage,"onUpdate:modelValue":[e[1]||(e[1]=r=>s.perPage=r),a.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(_,{cols:"12",md:"4"},{default:l(()=>[t(g,{modelValue:o.roleFilter,"onUpdate:modelValue":[e[2]||(e[2]=r=>o.roleFilter=r),a.loadUsers],items:o.roleOptions,label:"Filter by Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(_,{cols:"12",md:"4"},{default:l(()=>[t(v,{modelValue:s.search,"onUpdate:modelValue":e[3]||(e[3]=r=>s.search=r),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:a.loadUsers},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),t(k,null,{default:l(()=>[t(A,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[20]||(e[20]=n("span",null,"Users",-1)),n("span",G,[e[19]||(e[19]=u(" Total Records: ")),n("strong",null,i(s.pagination.total||0),1),o.users.length>0?(p(),c("span",J," | Showing "+i((s.currentPage-1)*s.perPage+1)+" to "+i(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+i(s.pagination.total),1)):w("",!0)])]),_:1,__:[20]}),t(V,null,{default:l(()=>[t(q,null,{default:l(()=>[n("thead",null,[n("tr",null,[n("th",{class:"sortable",onClick:e[4]||(e[4]=r=>a.onSort("name"))},[n("div",K,[e[21]||(e[21]=u(" Name ")),t(y,{icon:s.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),n("th",{class:"sortable",onClick:e[5]||(e[5]=r=>a.onSort("email"))},[n("div",Q,[e[22]||(e[22]=u(" Email ")),t(y,{icon:s.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[24]||(e[24]=n("th",null,"Role",-1)),n("th",{class:"sortable",onClick:e[6]||(e[6]=r=>a.onSort("created_at"))},[n("div",W,[e[23]||(e[23]=u(" Created ")),t(y,{icon:s.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[25]||(e[25]=n("th",null,"Actions",-1))])]),n("tbody",null,[(p(!0),c(S,null,I(o.users,r=>(p(),c("tr",{key:r.id},[n("td",null,[n("div",X,[t(E,{size:"32",color:"primary"},{default:l(()=>[n("span",Z,i(r.name.charAt(0).toUpperCase()),1)]),_:2},1024),u(" "+i(r.name),1)])]),n("td",null,i(r.email),1),n("td",null,[r.roles&&r.roles.length>0?(p(),c("div",$,[(p(!0),c(S,null,I(r.roles,f=>(p(),U(C,{key:f.id,color:a.getRoleColor(f.slug),size:"small"},{default:l(()=>[u(i(f.name),1)]),_:2},1032,["color"]))),128))])):(p(),c("span",ee,"No roles"))]),n("td",null,i(s.formatDate(r.created_at)),1),n("td",null,[t(m,{size:"small",icon:"mdi-pencil",onClick:f=>a.openDialog(r),variant:"text"},null,8,["onClick"]),t(m,{size:"small",icon:"mdi-delete",onClick:f=>a.deleteUser(r),variant:"text",color:"error",disabled:r.id===o.currentUserId},null,8,["onClick","disabled"])])]))),128)),o.users.length===0?(p(),c("tr",se,e[26]||(e[26]=[n("td",{colspan:"5",class:"text-center py-4"},"No users found",-1)]))):w("",!0)])]),_:1}),n("div",oe,[n("div",re,[o.users.length>0?(p(),c("span",te," Showing "+i((s.currentPage-1)*s.perPage+1)+" to "+i(Math.min(s.currentPage*s.perPage,s.pagination.total))+" of "+i(s.pagination.total)+" records ",1)):(p(),c("span",le," No records found "))]),s.pagination.last_page>1?(p(),U(R,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=r=>s.currentPage=r),a.loadUsers],length:s.pagination.last_page},null,8,["modelValue","length","onUpdate:modelValue"])):w("",!0)])]),_:1})]),_:1}),t(B,{modelValue:o.dialog,"onUpdate:modelValue":e[16]||(e[16]=r=>o.dialog=r),"max-width":"600",persistent:""},{default:l(()=>[t(k,null,{default:l(()=>[t(A,null,{default:l(()=>[u(i(o.editingUser?"Edit User":"Add New User"),1)]),_:1}),t(V,null,{default:l(()=>[t(N,{ref:"form",onSubmit:M(a.saveUser,["prevent"])},{default:l(()=>[t(v,{modelValue:o.form.name,"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.name=r),label:"Full Name",rules:[o.rules.required],required:"",class:"mb-4"},null,8,["modelValue","rules"]),t(v,{modelValue:o.form.email,"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.email=r),label:"Email",type:"email",rules:[o.rules.required,o.rules.email],required:"",class:"mb-4"},null,8,["modelValue","rules"]),t(g,{modelValue:o.form.role_ids,"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.role_ids=r),items:o.roles,"item-title":"label","item-value":"value",label:"Roles",rules:[o.rules.required],required:"",multiple:"",chips:"",class:"mb-4"},{item:l(({props:r,item:f})=>[t(x,O(j(r)),{title:l(()=>[u(i(f.raw.label)+" ",1),f.raw.is_system?(p(),U(C,{key:0,size:"x-small",color:"warning",class:"ml-2"},{default:l(()=>e[27]||(e[27]=[u(" System ")])),_:1,__:[27]})):w("",!0)]),subtitle:l(()=>[u(i(f.raw.description),1)]),_:2},1040)]),selection:l(({item:r,index:f})=>[f<2?(p(),U(C,{key:0,size:"small",class:"mr-1"},{default:l(()=>[u(i(r.raw.label),1)]),_:2},1024)):w("",!0),f===2?(p(),c("span",ne," (+"+i(o.form.role_ids.length-2)+" others) ",1)):w("",!0)]),_:1},8,["modelValue","items","rules"]),t(v,{modelValue:o.form.password,"onUpdate:modelValue":e[12]||(e[12]=r=>o.form.password=r),label:"Password",type:o.showPassword?"text":"password",rules:o.editingUser?[]:[o.rules.required,o.rules.minLength],required:!o.editingUser,hint:"Leave blank to keep current password","persistent-hint":"",class:"mb-4"},{"append-inner":l(()=>[t(m,{icon:"",variant:"text",size:"small",onClick:e[11]||(e[11]=r=>o.showPassword=!o.showPassword)},{default:l(()=>[t(y,null,{default:l(()=>[u(i(o.showPassword?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"]),!o.editingUser||o.form.password?(p(),U(v,{key:0,modelValue:o.form.password_confirmation,"onUpdate:modelValue":e[14]||(e[14]=r=>o.form.password_confirmation=r),label:"Confirm Password",type:o.showPasswordConfirmation?"text":"password",rules:o.form.password?[()=>!!o.form.password_confirmation||"Please confirm your password",()=>o.form.password_confirmation===o.form.password||"Passwords do not match"]:[],required:!!o.form.password,class:"mb-4"},{"append-inner":l(()=>[t(m,{icon:"",variant:"text",size:"small",onClick:e[13]||(e[13]=r=>o.showPasswordConfirmation=!o.showPasswordConfirmation)},{default:l(()=>[t(y,null,{default:l(()=>[u(i(o.showPasswordConfirmation?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"])):w("",!0),t(v,{modelValue:o.form.avatar,"onUpdate:modelValue":e[15]||(e[15]=r=>o.form.avatar=r),label:"Avatar URL",hint:"URL to user's avatar image","persistent-hint":"",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),t(D,null,{default:l(()=>[t(F),t(m,{onClick:a.closeDialog,variant:"text"},{default:l(()=>e[28]||(e[28]=[u("Cancel")])),_:1,__:[28]},8,["onClick"]),t(m,{onClick:a.saveUser,color:"primary",loading:o.saving},{default:l(()=>[u(i(o.editingUser?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const me=L(H,[["render",ae],["__scopeId","data-v-4f1427f5"]]);export{me as default};
