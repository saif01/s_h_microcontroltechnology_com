import{h as E}from"./moment-C5S46NFB.js";import{_ as T,d as y,b as s,w as t,a as c,c as l,g as u,r as d,f as h,t as _,m as g,h as J,D as x,o as i}from"./app-CTvEgi9s.js";import{r as j}from"./uploads-CnEkgyD_.js";import{U as F}from"./UserProfileDialog-_ZVqmGAn.js";const O={components:{UserProfileDialog:F},data(){return{drawer:!0,authStore:null,currentUser:null,userRoles:[],userPermissions:[],currentDate:E().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),unreadCount:0,unreadCountInterval:null,brandingLogo:null,siteName:null,profileDialogVisible:!1}},computed:{resolvedBrandingLogo(){return this.brandingLogo?this.resolveImageUrl(this.brandingLogo):null},resolvedUserAvatar(){return!this.currentUser||!this.currentUser.avatar?null:this.resolveImageUrl(this.currentUser.avatar)}},methods:{async loadUser(){var m;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const v=await this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=v.data,this.userRoles=v.data.roles||[],this.authStore&&(this.authStore.user=v.data,this.authStore.token=e,this.authStore.isAuthenticated=!0,this.authStore.extractRolesAndPermissions(v.data)),this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(f=>{f.permissions&&f.permissions.length>0&&f.permissions.forEach(a=>{this.userPermissions.includes(a.slug)||this.userPermissions.push(a.slug)})})}catch(e){console.error("Error loading user:",e),((m=e.response)==null?void 0:m.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadBrandingSettings(){try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/settings",{headers:{Authorization:`Bearer ${m}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value&&(this.siteName=e.data.general.site_name.value),e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value&&(this.brandingLogo=e.data.branding.logo.value)}catch(m){console.error("Error loading branding settings:",m)}},async logout(){await x().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(m){return this.authStore&&(this.authStore.hasRole&&this.authStore.hasRole(["administrator"])||this.authStore.hasPermission&&this.authStore.hasPermission(m))?!0:!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.userRoles&&this.userRoles.length>0&&this.userRoles.some(e=>e.slug==="administrator")?!0:this.userPermissions.includes(m)},canAccessLeads(){return!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.hasPermission("view-leads")||this.hasPermission("manage-leads")||this.hasPermission("export-leads")},async loadUnreadCount(){if(this.canAccessLeads())try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/leads/unread-count",{headers:{Authorization:`Bearer ${m}`}});this.unreadCount=e.data.count||0}catch(m){console.error("Error loading unread count:",m)}},startUnreadCountPolling(){this.loadUnreadCount(),this.unreadCountInterval=setInterval(()=>{this.loadUnreadCount()},3e4)},stopUnreadCountPolling(){this.unreadCountInterval&&(clearInterval(this.unreadCountInterval),this.unreadCountInterval=null)},resolveImageUrl(m){return j(m)},showProfileDialog(){this.profileDialogVisible=!0}},mounted(){this.authStore=x(),localStorage.getItem("admin_token")?(this.loadUser().then(()=>{this.startUnreadCountPolling()}),this.loadBrandingSettings()):this.$router.push("/admin/login")},provide(){return{refreshUnreadCount:()=>{this.loadUnreadCount()}}},watch:{$route(){this.loadUnreadCount()}},beforeUnmount(){this.stopUnreadCountPolling()}},q={class:"d-flex align-center justify-space-between w-100"},G={key:0,class:"unread-badge"},H={class:"pa-2"},K={key:1,class:"d-flex align-center mr-4"},Q={class:"footer-content"},W={class:"footer-brand"},X={class:"logo-wrapper"},Z=["src"],$={class:"footer-info"},ee={class:"copyright-text"};function te(m,e,v,f,a,n){const b=d("v-img"),U=d("v-avatar"),k=d("v-list-item-title"),r=d("v-list-item"),w=d("v-divider"),p=d("v-list-group"),A=d("v-list"),P=d("v-icon"),L=d("v-btn"),R=d("v-navigation-drawer"),B=d("v-app-bar-nav-icon"),C=d("v-chip"),S=d("v-spacer"),D=d("v-menu"),I=d("v-app-bar"),V=d("router-view"),N=d("v-container"),z=d("v-main"),M=d("v-footer"),Y=d("UserProfileDialog");return i(),y("div",null,[s(R,{modelValue:a.drawer,"onUpdate:modelValue":e[1]||(e[1]=o=>a.drawer=o),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:t(()=>[c("div",H,[s(L,{link:"",router:"",onClick:e[0]||(e[0]=o=>n.logout()),class:"logout-btn text-black",size:"small",block:""},{default:t(()=>[s(P,{left:""},{default:t(()=>e[6]||(e[6]=[h("mdi-logout")])),_:1,__:[6]}),e[7]||(e[7]=h("Logout "))]),_:1,__:[7]})])]),default:t(()=>[e[8]||(e[8]=c("div",{class:"sidebar-shapes"},[c("div",{class:"shape shape-1"}),c("div",{class:"shape shape-2"}),c("div",{class:"shape shape-3"})],-1)),a.currentUser?(i(),l(r,{key:0,class:"user-profile-header"},{prepend:t(()=>[s(U,{size:"48",class:"mr-3"},{default:t(()=>[s(b,{src:n.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"Logo",cover:""},null,8,["src"])]),_:1})]),default:t(()=>[s(k,{class:"text-h6 font-weight-bold"},{default:t(()=>[h(_(a.siteName||"Admin Panel"),1)]),_:1})]),_:1})):u("",!0),s(w,{class:"my-0 divider-glow"}),a.currentUser&&a.userPermissions.length>0?(i(),l(A,{key:1,density:"compact",nav:""},{default:t(()=>[n.hasPermission("access-dashboard")?(i(),l(p,{key:0,value:"overview","prepend-icon":"mdi-view-dashboard","no-action":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Overview"}),null,16)]),default:t(()=>[s(r,{"prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})]),_:1})):u("",!0),n.hasPermission("manage-products")||n.hasPermission("manage-services")||n.hasPermission("manage-about")||n.hasPermission("manage-announcements")||n.hasPermission("manage-blog")?(i(),l(p,{key:1,value:"content","prepend-icon":"mdi-file-document-edit","no-action":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Content Management"}),null,16)]),default:t(()=>[n.hasPermission("manage-products")?(i(),l(p,{key:0,value:"products","prepend-icon":"mdi-package-variant","no-action":"","sub-group":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Products"}),null,16)]),default:t(()=>[s(r,{"prepend-icon":"mdi-package-variant",title:"Products",to:{name:"AdminProducts"}}),s(r,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminCategories"}}),s(r,{"prepend-icon":"mdi-tag",title:"Tags",to:{name:"AdminTags"}})]),_:1})):u("",!0),n.hasPermission("manage-services")?(i(),l(r,{key:1,"prepend-icon":"mdi-wrench",title:"Services",to:{name:"AdminServices"},value:"Services",exact:""})):u("",!0),n.hasPermission("manage-about")?(i(),l(r,{key:2,"prepend-icon":"mdi-information",title:"About Page",to:{name:"AdminAbout"},value:"About",exact:""})):u("",!0),n.hasPermission("manage-announcements")?(i(),l(r,{key:3,"prepend-icon":"mdi-bullhorn",title:"Announcements",to:{name:"AdminAnnouncements"},value:"Announcements",exact:""})):u("",!0),n.hasPermission("manage-blog")?(i(),l(p,{key:4,value:"blog","prepend-icon":"mdi-post","no-action":"","sub-group":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Blog"}),null,16)]),default:t(()=>[s(r,{"prepend-icon":"mdi-post",title:"Blog Posts",to:{name:"AdminBlog"}}),s(r,{"prepend-icon":"mdi-folder",title:"Categories",to:{name:"AdminBlogCategories"}})]),_:1})):u("",!0)]),_:1})):u("",!0),n.hasPermission("manage-careers")||n.hasPermission("manage-applications")?(i(),l(p,{key:2,value:"careers","prepend-icon":"mdi-briefcase","no-action":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Careers"}),null,16)]),default:t(()=>[n.hasPermission("manage-careers")?(i(),l(r,{key:0,"prepend-icon":"mdi-briefcase",title:"Careers",to:{name:"AdminCareers"}})):u("",!0),n.hasPermission("manage-applications")?(i(),l(r,{key:1,"prepend-icon":"mdi-file-document-edit",title:"Job Applications",to:{name:"AdminJobApplications"}})):u("",!0)]),_:1})):u("",!0),n.hasPermission("manage-users")||n.hasPermission("manage-roles")?(i(),l(p,{key:3,value:"users","prepend-icon":"mdi-account-group","no-action":""},{activator:t(({props:o})=>[s(r,g(o,{title:"User Management"}),null,16)]),default:t(()=>[n.hasPermission("manage-users")?(i(),l(r,{key:0,"prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):u("",!0),n.hasPermission("manage-roles")?(i(),l(p,{key:1,value:"roles","prepend-icon":"mdi-shield-account","no-action":"","sub-group":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Roles & Permissions"}),null,16)]),default:t(()=>[s(r,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),s(r,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):u("",!0)]),_:1})):u("",!0),n.canAccessLeads()||n.hasPermission("manage-newsletters")?(i(),l(p,{key:4,value:"communication","prepend-icon":"mdi-email","no-action":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Communication"}),null,16)]),default:t(()=>[n.canAccessLeads()?(i(),l(r,{key:0,"prepend-icon":"mdi-email",to:{name:"AdminLeads"},value:"Leads",exact:"",class:"leads-menu-item"},{title:t(()=>[c("div",q,[e[5]||(e[5]=c("span",null,"Leads",-1)),a.unreadCount>0?(i(),y("span",G,_(a.unreadCount>99?"99+":a.unreadCount),1)):u("",!0)])]),_:1})):u("",!0),n.hasPermission("manage-newsletters")?(i(),l(r,{key:1,"prepend-icon":"mdi-email-newsletter",to:{name:"AdminNewsletters"},value:"Newsletters",exact:"",title:"Newsletters"})):u("",!0)]),_:1})):u("",!0),n.hasPermission("manage-settings")||n.hasPermission("view-login-logs")||n.hasPermission("view-visitor-logs")?(i(),l(p,{key:5,value:"system","prepend-icon":"mdi-cog","no-action":""},{activator:t(({props:o})=>[s(r,g(o,{title:"System & Administration"}),null,16)]),default:t(()=>[n.hasPermission("manage-settings")?(i(),l(r,{key:0,"prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):u("",!0),n.hasPermission("view-login-logs")||n.hasPermission("view-visitor-logs")?(i(),l(p,{key:1,value:"logs","prepend-icon":"mdi-file-document-multiple","no-action":"","sub-group":""},{activator:t(({props:o})=>[s(r,g(o,{title:"Logs"}),null,16)]),default:t(()=>[n.hasPermission("view-login-logs")?(i(),l(r,{key:0,"prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"}})):u("",!0),n.hasPermission("view-visitor-logs")?(i(),l(r,{key:1,"prepend-icon":"mdi-account-group",title:"Visitor Logs",to:{name:"AdminVisitorLogs"}})):u("",!0)]),_:1})):u("",!0)]),_:1})):u("",!0)]),_:1})):u("",!0)]),_:1,__:[8]},8,["modelValue"]),s(I,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:t(()=>[s(B,{onClick:e[2]||(e[2]=J(o=>a.drawer=!a.drawer,["stop"]))}),s(C,{class:"mx-2 date-chip"},{default:t(()=>[h(_(a.currentDate),1)]),_:1}),s(S),a.currentUser&&a.userRoles&&a.userRoles.some(o=>o.slug==="administrator")?(i(),l(C,{key:0,"prepend-icon":"mdi-shield-account"},{default:t(()=>e[9]||(e[9]=[h("Administrator")])),_:1,__:[9]})):u("",!0),s(S),a.currentUser?(i(),y("div",K,[s(D,{"open-on-hover":""},{activator:t(({props:o})=>[s(U,g(o,{size:"42",class:"fill-image mr-2",title:a.currentUser.name}),{default:t(()=>[a.currentUser.avatar?(i(),l(b,{key:0,cover:"",src:n.resolvedUserAvatar,alt:a.currentUser.name},null,8,["src","alt"])):(i(),l(b,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:t(()=>[s(A,null,{default:t(()=>[s(r,{onClick:n.showProfileDialog,style:{cursor:"pointer"}},{prepend:t(()=>[s(P,null,{default:t(()=>e[10]||(e[10]=[h("mdi-account")])),_:1,__:[10]})]),append:t(()=>[s(P,{size:"small"},{default:t(()=>e[11]||(e[11]=[h("mdi-chevron-right")])),_:1,__:[11]})]),default:t(()=>[s(k,null,{default:t(()=>[h(_(a.currentUser.name),1)]),_:1})]),_:1},8,["onClick"]),s(w,{class:"my-2"}),s(r,{link:"",router:"",onClick:e[3]||(e[3]=o=>n.logout())},{prepend:t(()=>[s(P,null,{default:t(()=>e[12]||(e[12]=[h("mdi-logout")])),_:1,__:[12]})]),default:t(()=>[s(k,null,{default:t(()=>e[13]||(e[13]=[h("Logout")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})])):u("",!0)]),_:1}),s(z,null,{default:t(()=>[s(N,{fluid:""},{default:t(()=>[s(V)]),_:1})]),_:1}),s(M,{class:"footer-modern gradient_color rtl-footer",app:""},{default:t(()=>[c("div",Q,[c("div",W,[c("div",X,[c("img",{src:n.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"},null,8,Z)]),e[14]||(e[14]=c("div",{class:"brand-text"},[c("span",{class:"brand-name"},"Powered By CPB-IT")],-1))]),e[16]||(e[16]=c("div",{class:"footer-divider"},null,-1)),c("div",$,[e[15]||(e[15]=c("span",{class:"version-badge"},"v1.0",-1)),c("span",ee,"Â© "+_(a.currentYear)+" All Rights Reserved",1)])])]),_:1}),s(Y,{modelValue:a.profileDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=o=>a.profileDialogVisible=o),user:a.currentUser},null,8,["modelValue","user"])])}const ie=T(O,[["render",te],["__scopeId","data-v-036a3cd6"]]);export{ie as default};
