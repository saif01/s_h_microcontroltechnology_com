import{_ as O,c as g,e as t,a as l,w as o,b as r,t as d,r as u,g as L,h as b,F as B,d as I,f as w,o as m}from"./app-DFYokcIO.js";import{a as T}from"./adminPaginationMixin-DN7Wb3ng.js";import{h as E}from"./moment-C5S46NFB.js";const H={mixins:[T],data(){return{logs:[],statistics:{total:0,human_visits:0,bot_visits:0,unique_ips:0},deviceFilter:null,browserFilter:null,botFilter:null,deviceOptions:[{title:"Desktop",value:"desktop"},{title:"Mobile",value:"mobile"},{title:"Tablet",value:"tablet"}],browserOptions:[],botOptions:[{title:"Human Only",value:"false"},{title:"Bots Only",value:"true"}],viewDialog:!1,selectedLog:null,selectedLogs:[],selectAll:!1}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const s=await w.get("/api/v1/visitor-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=s.data,s.data.browser_stats&&(this.browserOptions=Object.keys(s.data.browser_stats).map(e=>({title:e,value:e})))}catch(s){console.error("Error loading statistics:",s)}},async loadLogs(){try{this.loading=!0;const s=this.buildPaginationParams();this.search&&(s.search=this.search),this.deviceFilter&&(s.device_type=this.deviceFilter),this.browserFilter&&(s.browser=this.browserFilter),this.botFilter!==null&&(s.is_bot=this.botFilter);const e=await w.get("/api/v1/visitor-logs",{params:s,headers:this.getAuthHeaders()});this.logs=e.data.data||[],this.updatePagination(e.data)}catch(s){this.handleApiError(s,"Failed to load visitor logs")}finally{this.loading=!1}},viewLog(s){this.selectedLog=s,this.viewDialog=!0},async deleteLog(s){if(confirm("Are you sure you want to delete this visitor log?"))try{await w.delete(`/api/v1/visitor-logs/${s.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Visitor log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(e){this.handleApiError(e,"Error deleting visitor log")}},async deleteSelected(){if(this.selectedLogs.length!==0&&confirm(`Are you sure you want to delete ${this.selectedLogs.length} visitor log(s)?`))try{await w.post("/api/v1/visitor-logs/delete-multiple",{ids:this.selectedLogs},{headers:this.getAuthHeaders()}),this.showSuccess(`${this.selectedLogs.length} visitor log(s) deleted successfully`),this.selectedLogs=[],this.selectAll=!1,await this.loadStatistics(),await this.loadLogs()}catch(s){this.handleApiError(s,"Error deleting visitor logs")}},toggleSelectAll(){this.selectAll?this.selectedLogs=this.logs.map(s=>s.id):this.selectedLogs=[]},formatDate(s){return s?E(s).format("YYYY-MM-DD HH:mm:ss"):"-"},truncateText(s,e){return s?s.length>e?s.substring(0,e)+"...":s:"-"},getDeviceColor(s){return{desktop:"primary",mobile:"success",tablet:"info"}[s]||"grey"},onPerPageChange(){this.resetPagination(),this.loadLogs()},onSort(s){this.handleSort(s),this.loadLogs()}},watch:{selectedLogs(s){this.selectAll=s.length===this.logs.length&&this.logs.length>0}}},M={class:"page-header"},N={class:"d-flex align-center"},R={class:"text-h6"},Y={class:"d-flex align-center"},q={class:"text-h6"},j={class:"d-flex align-center"},G={class:"text-h6"},J={class:"d-flex align-center"},K={class:"text-h6"},Q={class:"d-flex align-center"},W={class:"d-flex align-center"},X={class:"d-flex align-center"},Z=["title"],$=["title"],ee={key:1,class:"text-grey"},te={key:0},le={class:"mb-3"},se={class:"mb-3"},oe={class:"mt-1"},ie=["href"],ne={class:"mb-3"},re={class:"mt-1"},de=["href"],ae={key:1,class:"text-grey"},ue={class:"mb-3"},ce={class:"mb-3"},me={class:"mb-3"},ge={class:"mb-3"},ve={class:"mb-3"},pe={class:"mb-3"};function _e(s,e,fe,be,i,a){const h=u("v-btn"),v=u("v-icon"),p=u("v-card-text"),_=u("v-card"),c=u("v-col"),V=u("v-row"),y=u("v-select"),S=u("v-text-field"),k=u("v-card-title"),A=u("v-checkbox"),f=u("v-chip"),C=u("v-table"),D=u("v-pagination"),U=u("v-textarea"),F=u("v-spacer"),P=u("v-card-actions"),z=u("v-dialog");return m(),g("div",null,[t("div",M,[e[13]||(e[13]=t("h1",{class:"text-h4 page-title"},"Visitor Log Management",-1)),l(h,{color:"error","prepend-icon":"mdi-delete",onClick:a.deleteSelected,disabled:i.selectedLogs.length===0},{default:o(()=>[r(" Delete Selected ("+d(i.selectedLogs.length)+") ",1)]),_:1},8,["onClick","disabled"])]),l(V,{class:"mb-4"},{default:o(()=>[l(c,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(p,null,{default:o(()=>[t("div",N,[l(v,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>e[14]||(e[14]=[r("mdi-account-group")])),_:1,__:[14]}),t("div",null,[t("div",R,d(i.statistics.total||0),1),e[15]||(e[15]=t("div",{class:"text-caption text-grey"},"Total Visits",-1))])])]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(p,null,{default:o(()=>[t("div",Y,[l(v,{color:"success",size:"40",class:"mr-3"},{default:o(()=>e[16]||(e[16]=[r("mdi-account")])),_:1,__:[16]}),t("div",null,[t("div",q,d(i.statistics.human_visits||0),1),e[17]||(e[17]=t("div",{class:"text-caption text-grey"},"Human Visits",-1))])])]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(p,null,{default:o(()=>[t("div",j,[l(v,{color:"warning",size:"40",class:"mr-3"},{default:o(()=>e[18]||(e[18]=[r("mdi-robot")])),_:1,__:[18]}),t("div",null,[t("div",G,d(i.statistics.bot_visits||0),1),e[19]||(e[19]=t("div",{class:"text-caption text-grey"},"Bot Visits",-1))])])]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",md:"3"},{default:o(()=>[l(_,null,{default:o(()=>[l(p,null,{default:o(()=>[t("div",J,[l(v,{color:"info",size:"40",class:"mr-3"},{default:o(()=>e[20]||(e[20]=[r("mdi-web")])),_:1,__:[20]}),t("div",null,[t("div",K,d(i.statistics.unique_ips||0),1),e[21]||(e[21]=t("div",{class:"text-caption text-grey"},"Unique IPs",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),l(_,{class:"mb-4"},{default:o(()=>[l(p,null,{default:o(()=>[l(V,null,{default:o(()=>[l(c,{cols:"12",md:"2"},{default:o(()=>[l(y,{modelValue:s.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>s.perPage=n),a.onPerPageChange],items:s.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(c,{cols:"12",md:"2"},{default:o(()=>[l(y,{modelValue:i.deviceFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>i.deviceFilter=n),a.loadLogs],items:i.deviceOptions,label:"Device Type","prepend-inner-icon":"mdi-devices",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(c,{cols:"12",md:"2"},{default:o(()=>[l(y,{modelValue:i.browserFilter,"onUpdate:modelValue":[e[2]||(e[2]=n=>i.browserFilter=n),a.loadLogs],items:i.browserOptions,label:"Browser","prepend-inner-icon":"mdi-web",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(c,{cols:"12",md:"2"},{default:o(()=>[l(y,{modelValue:i.botFilter,"onUpdate:modelValue":[e[3]||(e[3]=n=>i.botFilter=n),a.loadLogs],items:i.botOptions,label:"Bot Filter","prepend-inner-icon":"mdi-robot",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(c,{cols:"12",md:"4"},{default:o(()=>[l(S,{modelValue:s.search,"onUpdate:modelValue":[e[4]||(e[4]=n=>s.search=n),a.loadLogs],label:"Search (IP, URL, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(_,null,{default:o(()=>[l(k,null,{default:o(()=>e[22]||(e[22]=[r("Visitor Logs")])),_:1,__:[22]}),l(p,null,{default:o(()=>[l(C,null,{default:o(()=>[t("thead",null,[t("tr",null,[t("th",null,[l(A,{modelValue:i.selectAll,"onUpdate:modelValue":e[5]||(e[5]=n=>i.selectAll=n),onChange:a.toggleSelectAll,density:"compact"},null,8,["modelValue","onChange"])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=n=>a.onSort("ip_address"))},[t("div",Q,[e[23]||(e[23]=r(" IP Address ")),l(v,{icon:s.getSortIcon("ip_address"),size:"small",class:"ml-1"},null,8,["icon"])])]),t("th",{class:"sortable",onClick:e[7]||(e[7]=n=>a.onSort("url"))},[t("div",W,[e[24]||(e[24]=r(" URL ")),l(v,{icon:s.getSortIcon("url"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[26]||(e[26]=t("th",null,"Device",-1)),e[27]||(e[27]=t("th",null,"Browser",-1)),e[28]||(e[28]=t("th",null,"OS",-1)),e[29]||(e[29]=t("th",null,"Referer",-1)),t("th",{class:"sortable",onClick:e[8]||(e[8]=n=>a.onSort("created_at"))},[t("div",X,[e[25]||(e[25]=r(" Date ")),l(v,{icon:s.getSortIcon("created_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[30]||(e[30]=t("th",null,"Actions",-1))])]),t("tbody",null,[(m(!0),g(B,null,I(i.logs,n=>(m(),g("tr",{key:n.id},[t("td",null,[l(A,{value:n.id,modelValue:i.selectedLogs,"onUpdate:modelValue":e[9]||(e[9]=x=>i.selectedLogs=x),density:"compact"},null,8,["value","modelValue"])]),t("td",null,[l(f,{size:"small",variant:"outlined"},{default:o(()=>[r(d(n.ip_address||"-"),1)]),_:2},1024)]),t("td",null,[t("span",{class:"text-caption",title:n.url},d(a.truncateText(n.url,40)),9,Z)]),t("td",null,[l(f,{size:"small",color:a.getDeviceColor(n.device_type)},{default:o(()=>[r(d(n.device_type||"-"),1)]),_:2},1032,["color"]),n.is_bot?(m(),L(f,{key:0,size:"x-small",color:"warning",class:"ml-1"},{default:o(()=>e[31]||(e[31]=[r("Bot")])),_:1,__:[31]})):b("",!0)]),t("td",null,d(n.browser||"-"),1),t("td",null,d(n.os||"-"),1),t("td",null,[n.referer?(m(),g("span",{key:0,class:"text-caption",title:n.referer},d(a.truncateText(n.referer,30)),9,$)):(m(),g("span",ee,"-"))]),t("td",null,d(a.formatDate(n.created_at)),1),t("td",null,[l(h,{size:"small",icon:"mdi-eye",onClick:x=>a.viewLog(n),variant:"text"},null,8,["onClick"]),l(h,{size:"small",icon:"mdi-delete",onClick:x=>a.deleteLog(n),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),i.logs.length===0?(m(),g("tr",te,e[32]||(e[32]=[t("td",{colspan:"9",class:"text-center py-4"},"No visitor logs found",-1)]))):b("",!0)])]),_:1}),s.pagination.last_page>1?(m(),L(D,{key:0,modelValue:s.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=n=>s.currentPage=n),a.loadLogs],length:s.pagination.last_page,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):b("",!0)]),_:1})]),_:1}),l(z,{modelValue:i.viewDialog,"onUpdate:modelValue":e[12]||(e[12]=n=>i.viewDialog=n),"max-width":"800"},{default:o(()=>[i.selectedLog?(m(),L(_,{key:0},{default:o(()=>[l(k,null,{default:o(()=>e[33]||(e[33]=[r("Visitor Log Details")])),_:1,__:[33]}),l(p,null,{default:o(()=>[l(V,null,{default:o(()=>[l(c,{cols:"12",md:"6"},{default:o(()=>[t("div",le,[e[34]||(e[34]=t("strong",null,"IP Address:",-1)),r(" "+d(i.selectedLog.ip_address||"-"),1)]),t("div",se,[e[35]||(e[35]=t("strong",null,"URL:",-1)),t("div",oe,[t("a",{href:i.selectedLog.url,target:"_blank",class:"text-primary"},d(i.selectedLog.url),9,ie)])]),t("div",ne,[e[36]||(e[36]=t("strong",null,"Referer:",-1)),t("div",re,[i.selectedLog.referer?(m(),g("a",{key:0,href:i.selectedLog.referer,target:"_blank",class:"text-primary"},d(i.selectedLog.referer),9,de)):(m(),g("span",ae,"-"))])]),t("div",ue,[e[37]||(e[37]=t("strong",null,"Method:",-1)),r(" "+d(i.selectedLog.method||"GET"),1)])]),_:1}),l(c,{cols:"12",md:"6"},{default:o(()=>[t("div",ce,[e[39]||(e[39]=t("strong",null,"Device Type:",-1)),l(f,{size:"small",color:a.getDeviceColor(i.selectedLog.device_type),class:"ml-2"},{default:o(()=>[r(d(i.selectedLog.device_type||"-"),1)]),_:1},8,["color"]),i.selectedLog.is_bot?(m(),L(f,{key:0,size:"small",color:"warning",class:"ml-2"},{default:o(()=>e[38]||(e[38]=[r("Bot")])),_:1,__:[38]})):b("",!0)]),t("div",me,[e[40]||(e[40]=t("strong",null,"Browser:",-1)),r(" "+d(i.selectedLog.browser||"-"),1)]),t("div",ge,[e[41]||(e[41]=t("strong",null,"OS:",-1)),r(" "+d(i.selectedLog.os||"-"),1)]),t("div",ve,[e[42]||(e[42]=t("strong",null,"Page Views:",-1)),r(" "+d(i.selectedLog.page_views||1),1)]),t("div",pe,[e[43]||(e[43]=t("strong",null,"Created At:",-1)),r(" "+d(a.formatDate(i.selectedLog.created_at)),1)])]),_:1}),l(c,{cols:"12"},{default:o(()=>[e[44]||(e[44]=t("div",{class:"mb-2"},[t("strong",null,"User Agent:")],-1)),l(U,{value:i.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[44]})]),_:1})]),_:1}),l(P,null,{default:o(()=>[l(F),l(h,{onClick:e[11]||(e[11]=n=>i.viewDialog=!1),variant:"text"},{default:o(()=>e[45]||(e[45]=[r("Close")])),_:1,__:[45]})]),_:1})]),_:1})):b("",!0)]),_:1},8,["modelValue"])])}const we=O(H,[["render",_e],["__scopeId","data-v-af8a90e9"]]);export{we as default};
