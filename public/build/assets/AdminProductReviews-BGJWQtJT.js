import{h as O}from"./moment-C5S46NFB.js";import{a as B}from"./adminPaginationMixin-DN7Wb3ng.js";import{_ as Y,d as f,a as s,b as t,w as l,r,f as a,g as m,t as d,c as h,F as q,e as G,o as u,m as J}from"./app-BqCiNqnM.js";const K={name:"AdminProductReviews",mixins:[B],data(){return{reviews:[],selectedReview:null,reviewToDelete:null,showDetailsDialog:!1,showDeleteDialog:!1,processing:!1,statusFilter:null,ratingFilter:null,statusOptions:[{title:"Pending",value:"pending"},{title:"Approved",value:"approved"},{title:"Rejected",value:"rejected"}],ratingOptions:[{title:"5 Stars",value:5},{title:"4 Stars & Above",value:4},{title:"3 Stars & Above",value:3},{title:"2 Stars & Above",value:2},{title:"1 Star & Above",value:1}]}},async mounted(){await this.loadReviews()},methods:{async loadReviews(){try{this.loading=!0;const o=this.buildPaginationParams();this.search&&(o.search=this.search),this.statusFilter&&(o.status=this.statusFilter),this.ratingFilter&&(o.rating=this.ratingFilter);const e=await this.$axios.get("/api/v1/products/reviews/all",{params:o,headers:this.getAuthHeaders()});this.reviews=e.data.data||[],this.updatePagination(e.data)}catch(o){this.handleApiError(o,"Failed to load reviews")}finally{this.loading=!1}},onSearchChange(o){this.search=o,this.resetPagination(),this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=setTimeout(()=>{this.loadReviews()},350)},viewReview(o){this.selectedReview=o,this.showDetailsDialog=!0},async approveReview(o){var e,v;try{if(this.processing=!0,!this.getAuthToken()){this.showError("Authentication token not found. Please login again."),this.$router.push("/admin/login");return}await this.$axios.put(`/api/v1/products/${o.product_id}/reviews/${o.id}/approve`,{},{headers:this.getAuthHeaders()}),this.$toast.success("Review approved successfully"),this.showDetailsDialog=!1,await this.loadReviews()}catch(g){((e=g.response)==null?void 0:e.status)===401||((v=g.response)==null?void 0:v.status)===403?(this.showError("Session expired. Please login again."),localStorage.removeItem("admin_token"),this.$router.push("/admin/login")):this.handleApiError(g,"Failed to approve review")}finally{this.processing=!1}},async rejectReview(o){var e,v;try{if(this.processing=!0,!this.getAuthToken()){this.showError("Authentication token not found. Please login again."),this.$router.push("/admin/login");return}await this.$axios.put(`/api/v1/products/${o.product_id}/reviews/${o.id}/reject`,{},{headers:this.getAuthHeaders()}),this.$toast.success("Review rejected successfully"),this.showDetailsDialog=!1,await this.loadReviews()}catch(g){((e=g.response)==null?void 0:e.status)===401||((v=g.response)==null?void 0:v.status)===403?(this.showError("Session expired. Please login again."),localStorage.removeItem("admin_token"),this.$router.push("/admin/login")):this.handleApiError(g,"Failed to reject review")}finally{this.processing=!1}},confirmDelete(o){this.reviewToDelete=o,this.showDeleteDialog=!0},async deleteReview(){var o,e;if(this.reviewToDelete)try{if(this.processing=!0,!this.getAuthToken()){this.showError("Authentication token not found. Please login again."),this.$router.push("/admin/login");return}await this.$axios.delete(`/api/v1/products/${this.reviewToDelete.product_id}/reviews/${this.reviewToDelete.id}`,{headers:this.getAuthHeaders()}),this.$toast.success("Review deleted successfully"),this.showDeleteDialog=!1,this.showDetailsDialog=!1,await this.loadReviews()}catch(v){((o=v.response)==null?void 0:o.status)===401||((e=v.response)==null?void 0:e.status)===403?(this.showError("Session expired. Please login again."),localStorage.removeItem("admin_token"),this.$router.push("/admin/login")):this.handleApiError(v,"Failed to delete review")}finally{this.processing=!1,this.reviewToDelete=null}},getStatusColor(o){return{pending:"warning",approved:"success",rejected:"error"}[o]||"grey"},getStatusLabel(o){return{pending:"Pending",approved:"Approved",rejected:"Rejected"}[o]||o},formatDate(o){return O(o).format("MMM DD, YYYY h:mm A")}}},Q={class:"text-caption text-grey"},W={key:0},X={key:0},Z={class:"text-body-2 font-weight-bold"},$={class:"text-caption text-grey"},ee={class:"d-flex align-center"},te={class:"text-body-2"},le={class:"text-caption"},se={style:{"max-width":"300px"}},oe={key:0,class:"text-body-2 font-weight-bold"},ie={key:1,class:"text-caption text-grey text-truncate"},ne={key:2,class:"text-caption mt-1"},ae={class:"text-caption"},re={class:"text-center"},de={key:1},ue={colspan:"7",class:"text-center pa-8"},ce={key:2},me={colspan:"7",class:"text-center pa-8"},pe={class:"text-body-1"},ve={class:"text-body-1"},ge={class:"text-body-2 mt-1"},_e={class:"text-body-1"},fe={class:"text-body-1"},he={class:"text-body-1"},we={class:"text-body-1"};function be(o,e,v,g,n,c){const V=r("v-select"),p=r("v-col"),z=r("v-text-field"),P=r("v-row"),y=r("v-card-text"),R=r("v-card"),A=r("v-card-title"),_=r("v-icon"),U=r("v-avatar"),k=r("v-chip"),C=r("v-rating"),w=r("v-btn"),D=r("v-list-item-title"),x=r("v-list-item"),E=r("v-divider"),N=r("v-list"),M=r("v-menu"),H=r("v-progress-circular"),I=r("v-table"),L=r("v-pagination"),S=r("v-spacer"),F=r("v-card-actions"),T=r("v-dialog");return u(),f("div",null,[e[48]||(e[48]=s("div",{class:"page-header"},[s("h1",{class:"text-h4 page-title"},"Product Reviews Management")],-1)),t(R,{class:"mb-4"},{default:l(()=>[t(y,null,{default:l(()=>[t(P,null,{default:l(()=>[t(p,{cols:"12",md:"3"},{default:l(()=>[t(V,{modelValue:o.perPage,"onUpdate:modelValue":[e[0]||(e[0]=i=>o.perPage=i),o.onPerPageChange],items:o.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(p,{cols:"12",md:"3"},{default:l(()=>[t(V,{modelValue:n.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=i=>n.statusFilter=i),c.loadReviews],items:n.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(p,{cols:"12",md:"3"},{default:l(()=>[t(V,{modelValue:n.ratingFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>n.ratingFilter=i),c.loadReviews],items:n.ratingOptions,label:"Filter by Rating","prepend-inner-icon":"mdi-star",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(p,{cols:"12",md:"3"},{default:l(()=>[t(z,{modelValue:o.search,"onUpdate:modelValue":[e[3]||(e[3]=i=>o.search=i),c.onSearchChange],label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(R,null,{default:l(()=>[t(A,{class:"d-flex justify-space-between align-center"},{default:l(()=>[s("span",Q,[e[12]||(e[12]=a(" Total Records: ")),s("strong",null,d(o.pagination.total||0),1),n.reviews.length>0?(u(),f("span",W," | Showing "+d((o.currentPage-1)*o.perPage+1)+" to "+d(Math.min(o.currentPage*o.perPage,o.pagination.total))+" of "+d(o.pagination.total),1)):m("",!0)])]),_:1}),t(y,null,{default:l(()=>[t(I,null,{default:l(()=>[e[25]||(e[25]=s("thead",null,[s("tr",null,[s("th",null,"Product"),s("th",null,"Reviewer"),s("th",null,"Rating"),s("th",null,"Comment"),s("th",null,"Status"),s("th",null,"Date"),s("th",{class:"text-center"},"Actions")])],-1)),!o.loading&&n.reviews.length>0?(u(),f("tbody",X,[(u(!0),f(q,null,G(n.reviews,i=>{var j;return u(),f("tr",{key:i.id},[s("td",null,[s("div",Z,d(((j=i.product)==null?void 0:j.title)||"N/A"),1),s("div",$,"#"+d(i.product_id),1)]),s("td",null,[s("div",ee,[t(U,{size:"32",class:"mr-2"},{default:l(()=>[t(_,null,{default:l(()=>e[13]||(e[13]=[a("mdi-account-circle")])),_:1,__:[13]})]),_:1}),s("div",null,[s("div",te,d(i.reviewer_display_name||"Anonymous"),1),i.verified_purchase?(u(),h(k,{key:0,size:"x-small",color:"success",variant:"flat"},{default:l(()=>[t(_,{size:"x-small",class:"mr-1"},{default:l(()=>e[14]||(e[14]=[a("mdi-check-decagram")])),_:1,__:[14]}),e[15]||(e[15]=a(" Verified "))]),_:1,__:[15]})):m("",!0)])])]),s("td",null,[t(C,{"model-value":i.rating,readonly:"",length:5,size:16,"active-color":"amber",color:"grey-lighten-1",density:"compact","half-increments":""},null,8,["model-value"]),s("div",le,d(i.rating)+" / 5.0",1)]),s("td",se,[i.title?(u(),f("div",oe,d(i.title),1)):m("",!0),i.comment?(u(),f("div",ie,d(i.comment),1)):m("",!0),i.helpful_count>0?(u(),f("div",ne,[t(_,{size:"small",color:"success"},{default:l(()=>e[16]||(e[16]=[a("mdi-thumb-up")])),_:1,__:[16]}),a(" "+d(i.helpful_count)+" ",1),t(_,{size:"small",color:"error",class:"ml-2"},{default:l(()=>e[17]||(e[17]=[a("mdi-thumb-down")])),_:1,__:[17]}),a(" "+d(i.not_helpful_count),1)])):m("",!0)]),s("td",null,[t(k,{color:c.getStatusColor(i.status),size:"small",variant:"flat"},{default:l(()=>[a(d(c.getStatusLabel(i.status)),1)]),_:2},1032,["color"])]),s("td",null,[s("div",ae,d(c.formatDate(i.created_at)),1)]),s("td",re,[t(M,null,{activator:l(({props:b})=>[t(w,J({ref_for:!0},b,{icon:"mdi-dots-vertical",size:"small",variant:"text"}),null,16)]),default:l(()=>[t(N,{density:"compact"},{default:l(()=>[t(x,{onClick:b=>c.viewReview(i),"prepend-icon":"mdi-eye"},{default:l(()=>[t(D,null,{default:l(()=>e[18]||(e[18]=[a("View Details")])),_:1,__:[18]})]),_:2},1032,["onClick"]),i.status!=="approved"?(u(),h(x,{key:0,onClick:b=>c.approveReview(i),"prepend-icon":"mdi-check-circle",disabled:n.processing},{default:l(()=>[t(D,null,{default:l(()=>e[19]||(e[19]=[a("Approve")])),_:1,__:[19]})]),_:2},1032,["onClick","disabled"])):m("",!0),i.status!=="rejected"?(u(),h(x,{key:1,onClick:b=>c.rejectReview(i),"prepend-icon":"mdi-close-circle",disabled:n.processing},{default:l(()=>[t(D,null,{default:l(()=>e[20]||(e[20]=[a("Reject")])),_:1,__:[20]})]),_:2},1032,["onClick","disabled"])):m("",!0),t(E),t(x,{onClick:b=>c.confirmDelete(i),"prepend-icon":"mdi-delete",disabled:n.processing},{default:l(()=>[t(D,{class:"text-error"},{default:l(()=>e[21]||(e[21]=[a("Delete")])),_:1,__:[21]})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024)])])}),128))])):!o.loading&&n.reviews.length===0?(u(),f("tbody",de,[s("tr",null,[s("td",ue,[t(_,{size:"64",color:"grey-lighten-1"},{default:l(()=>e[22]||(e[22]=[a("mdi-star-off")])),_:1,__:[22]}),e[23]||(e[23]=s("p",{class:"text-h6 text-grey mt-4"},"No reviews found",-1))])])])):(u(),f("tbody",ce,[s("tr",null,[s("td",me,[t(H,{indeterminate:"",color:"primary"}),e[24]||(e[24]=s("p",{class:"text-grey mt-4"},"Loading reviews...",-1))])])]))]),_:1,__:[25]}),o.pagination.last_page>1?(u(),h(L,{key:0,modelValue:o.currentPage,"onUpdate:modelValue":[e[4]||(e[4]=i=>o.currentPage=i),c.loadReviews],length:o.pagination.last_page,"total-visible":7,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"])):m("",!0)]),_:1})]),_:1}),t(T,{modelValue:n.showDetailsDialog,"onUpdate:modelValue":e[9]||(e[9]=i=>n.showDetailsDialog=i),"max-width":"700",scrollable:""},{default:l(()=>[n.selectedReview?(u(),h(R,{key:0},{default:l(()=>[t(A,{class:"d-flex align-center justify-space-between bg-primary text-white pa-4"},{default:l(()=>[e[26]||(e[26]=s("span",{class:"text-h5 font-weight-bold"},"Review Details",-1)),t(w,{icon:"mdi-close",variant:"text",color:"white",onClick:e[5]||(e[5]=i=>n.showDetailsDialog=!1)})]),_:1,__:[26]}),t(y,{class:"pa-6"},{default:l(()=>[t(P,null,{default:l(()=>[t(p,{cols:"12"},{default:l(()=>{var i;return[e[27]||(e[27]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Product",-1)),s("div",pe,d(((i=n.selectedReview.product)==null?void 0:i.title)||"N/A"),1)]}),_:1,__:[27]}),t(p,{cols:"12",md:"6"},{default:l(()=>[e[30]||(e[30]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Reviewer",-1)),s("div",ve,d(n.selectedReview.reviewer_display_name||"Anonymous"),1),n.selectedReview.verified_purchase?(u(),h(k,{key:0,size:"small",color:"success",class:"mt-1"},{default:l(()=>[t(_,{size:"small",class:"mr-1"},{default:l(()=>e[28]||(e[28]=[a("mdi-check-decagram")])),_:1,__:[28]}),e[29]||(e[29]=a(" Verified Purchase "))]),_:1,__:[29]})):m("",!0)]),_:1,__:[30]}),t(p,{cols:"12",md:"6"},{default:l(()=>[e[31]||(e[31]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Rating",-1)),t(C,{"model-value":n.selectedReview.rating,readonly:"",length:5,size:24,"active-color":"amber",color:"grey-lighten-1","half-increments":""},null,8,["model-value"]),s("div",ge,d(n.selectedReview.rating)+" / 5.0",1)]),_:1,__:[31]}),n.selectedReview.title?(u(),h(p,{key:0,cols:"12"},{default:l(()=>[e[32]||(e[32]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Title",-1)),s("div",_e,d(n.selectedReview.title),1)]),_:1,__:[32]})):m("",!0),n.selectedReview.comment?(u(),h(p,{key:1,cols:"12"},{default:l(()=>[e[33]||(e[33]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Comment",-1)),s("div",fe,d(n.selectedReview.comment),1)]),_:1,__:[33]})):m("",!0),t(p,{cols:"12",md:"4"},{default:l(()=>[e[34]||(e[34]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Status",-1)),t(k,{color:c.getStatusColor(n.selectedReview.status),variant:"flat"},{default:l(()=>[a(d(c.getStatusLabel(n.selectedReview.status)),1)]),_:1},8,["color"])]),_:1,__:[34]}),t(p,{cols:"12",md:"4"},{default:l(()=>[e[37]||(e[37]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Helpful",-1)),s("div",he,[t(_,{color:"success"},{default:l(()=>e[35]||(e[35]=[a("mdi-thumb-up")])),_:1,__:[35]}),a(" "+d(n.selectedReview.helpful_count)+" ",1),t(_,{color:"error",class:"ml-2"},{default:l(()=>e[36]||(e[36]=[a("mdi-thumb-down")])),_:1,__:[36]}),a(" "+d(n.selectedReview.not_helpful_count),1)])]),_:1,__:[37]}),t(p,{cols:"12",md:"4"},{default:l(()=>[e[38]||(e[38]=s("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Submitted",-1)),s("div",we,d(c.formatDate(n.selectedReview.created_at)),1)]),_:1,__:[38]})]),_:1})]),_:1}),t(F,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(S),n.selectedReview.status!=="approved"?(u(),h(w,{key:0,color:"success",variant:"flat",onClick:e[6]||(e[6]=i=>c.approveReview(n.selectedReview)),loading:n.processing},{default:l(()=>[t(_,{class:"mr-2"},{default:l(()=>e[39]||(e[39]=[a("mdi-check-circle")])),_:1,__:[39]}),e[40]||(e[40]=a(" Approve "))]),_:1,__:[40]},8,["loading"])):m("",!0),n.selectedReview.status!=="rejected"?(u(),h(w,{key:1,color:"error",variant:"flat",onClick:e[7]||(e[7]=i=>c.rejectReview(n.selectedReview)),loading:n.processing},{default:l(()=>[t(_,{class:"mr-2"},{default:l(()=>e[41]||(e[41]=[a("mdi-close-circle")])),_:1,__:[41]}),e[42]||(e[42]=a(" Reject "))]),_:1,__:[42]},8,["loading"])):m("",!0),t(w,{variant:"text",onClick:e[8]||(e[8]=i=>n.showDetailsDialog=!1)},{default:l(()=>e[43]||(e[43]=[a("Close")])),_:1,__:[43]})]),_:1})]),_:1})):m("",!0)]),_:1},8,["modelValue"]),t(T,{modelValue:n.showDeleteDialog,"onUpdate:modelValue":e[11]||(e[11]=i=>n.showDeleteDialog=i),"max-width":"400"},{default:l(()=>[t(R,null,{default:l(()=>[t(A,{class:"text-h6"},{default:l(()=>e[44]||(e[44]=[a("Confirm Delete")])),_:1,__:[44]}),t(y,null,{default:l(()=>e[45]||(e[45]=[a(" Are you sure you want to delete this review? This action cannot be undone. ")])),_:1,__:[45]}),t(F,null,{default:l(()=>[t(S),t(w,{variant:"text",onClick:e[10]||(e[10]=i=>n.showDeleteDialog=!1)},{default:l(()=>e[46]||(e[46]=[a("Cancel")])),_:1,__:[46]}),t(w,{color:"error",variant:"flat",onClick:c.deleteReview,loading:n.processing},{default:l(()=>e[47]||(e[47]=[a("Delete")])),_:1,__:[47]},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const De=Y(K,[["render",be],["__scopeId","data-v-15001bd8"]]);export{De as default};
